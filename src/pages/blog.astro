---
import '../styles/global.css';
import Header from '../components/Header.astro';
import BlogLoading from '../components/loaders/BlogLoading.astro';
import getAllBlogs, { getBlogsByCategory } from '../utils/blog.ts';

// Get actual blog posts and categories
const allBlogs = getAllBlogs();

// Create content data based on actual blog posts
const contentData = {
  overview: {
    posts: allBlogs.map((blog, index) => ({
      id: index + 1,
      title: blog.title,
      excerpt: blog.description,
      category: blog.category,
      slug: blog.slug,
      pubDate: blog.pubDate,
      author: blog.author,
      tags: blog.tags || []
    })),
  },
  research: {
    posts: getBlogsByCategory('Research').map((blog, index) => ({
      id: index + 1,
      title: blog.title,
      excerpt: blog.description,
      category: blog.category,
      slug: blog.slug,
      pubDate: blog.pubDate,
      author: blog.author,
      tags: blog.tags || []
    })),
  },
  events: {
    posts: getBlogsByCategory('Events').map((blog, index) => ({
      id: index + 1,
      title: blog.title,
      excerpt: blog.description,
      category: blog.category,
      slug: blog.slug,
      pubDate: blog.pubDate,
      author: blog.author,
      tags: blog.tags || []
    })),
  },
  news: {
    posts: getBlogsByCategory('News').map((blog, index) => ({
      id: index + 1,
      title: blog.title,
      excerpt: blog.description,
      category: blog.category,
      slug: blog.slug,
      pubDate: blog.pubDate,
      author: blog.author,
      tags: blog.tags || []
    })),
  }
};
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>Blog - ALIFE</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
    /* Slide-in animation styles for back navigation from blog pages */
    .slide-in-from-left {
      transform: translateX(-100%);
      opacity: 0;
      transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.6s ease-out;
    }

    .slide-in-from-left.animate {
      transform: translateX(0);
      opacity: 1;
    }

    /* Staggered animation for child elements */
    .slide-in-from-left .hero-section,
    .slide-in-from-left .tabs-section,
    .slide-in-from-left .content-section {
      transform: translateX(-50px);
      opacity: 0;
      transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.5s ease-out;
    }

    .slide-in-from-left.animate .hero-section {
      transition-delay: 0.1s;
    }

    .slide-in-from-left.animate .tabs-section {
      transition-delay: 0.2s;
    }

    .slide-in-from-left.animate .content-section {
      transition-delay: 0.3s;
    }

    .slide-in-from-left.animate .hero-section,
    .slide-in-from-left.animate .tabs-section,
    .slide-in-from-left.animate .content-section {
      transform: translateX(0);
      opacity: 1;
    }

    /* Card animation styles for tab switching */
    .blog-card {
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.4s ease-out, transform 0.4s ease-out;
    }

    .blog-card.animate {
      opacity: 1;
      transform: translateY(0);
    }

    /* Staggered animation for cards */
    .blog-card:nth-child(1) { transition-delay: 0.1s; }
    .blog-card:nth-child(2) { transition-delay: 0.2s; }
    .blog-card:nth-child(3) { transition-delay: 0.3s; }
    .blog-card:nth-child(4) { transition-delay: 0.4s; }
    .blog-card:nth-child(5) { transition-delay: 0.5s; }
    .blog-card:nth-child(6) { transition-delay: 0.6s; }
    .blog-card:nth-child(7) { transition-delay: 0.7s; }
    .blog-card:nth-child(8) { transition-delay: 0.8s; }
    </style>
  </head>

  <body class="min-h-screen bg-gray-50">
    <div id="loading-screen" class="fixed inset-0 z-50 transition-all duration-700 ease-in-out">
      <BlogLoading />
    </div>

    <div id="main-content" class="opacity-0 transition-opacity duration-500 ease-in hidden">
      <Header />

      <main id="blog-content" class="max-w-7xl mx-auto px-4 py-12" style="font-family: 'DM Sans', sans-serif;">
        <div class="text-center mb-12 hero-section">
          <h1 class="text-4xl md:text-5xl font-bold text-primary mb-4" style="font-family: 'GT Alpina Fine', serif;">Sharing Our Journey</h1>
          <p class="text-medium text-gray-600 max-w-3xl mx-auto font-light">
            Research breakthroughs, upcoming events, and latest news from the frontier of evolutionary AI
          </p>
        </div>

        <div class="mb-8 tabs-section">
          <div class="overflow-x-auto">
            <div class="flex justify-center min-w-max">
              <div class="flex bg-gray-100 rounded-full p-1 font-light text-sm">
                <button id="overview-tab" class="active-tab px-6 py-2 rounded-full bg-primary text-white transition-all duration-200 whitespace-nowrap">
                  Overview
                </button>
                <button id="research-tab" class="tab px-6 py-2 rounded-full text-primary hover:bg-gray-200 transition-all duration-200 whitespace-nowrap">
                  Research
                </button>
                <button id="events-tab" class="tab px-6 py-2 rounded-full text-primary hover:bg-gray-200 transition-all duration-200 whitespace-nowrap">
                  Events
                </button>
                <button id="news-tab" class="tab px-6 py-2 rounded-full text-primary hover:bg-gray-200 transition-all duration-200 whitespace-nowrap">
                  News
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Separator line -->
        <div class="border-b border-gray-200 mb-8"></div>

        <div class="w-full content-section">
          <div id="tab-content" class="w-full">
            <!-- Overview content (default) -->
            <div id="overview-content" class="tab-content">
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                {contentData.overview.posts.map(post => (
                  <a href={`/blog/${post.slug}`} class="block group blog-card">
                    <div class="mb-6">
                      <img 
                        src="/assets/images/image.png"
                        loading="lazy"
                        alt={post.title}
                        class="w-full h-48 object-cover rounded-lg"
                      />
                    </div>
                    <div class="space-y-3">
                      <h2 class="text-xl font-bold text-gray-900 leading-snug group-hover:text-primary transition-colors duration-200" style="font-family: 'GT Alpina Fine', serif;">
                        {post.title}
                      </h2>
                      <p class="text-gray-600 text-sm leading-relaxed line-clamp-3 font-light">
                        {post.excerpt}
                      </p>
                    </div>
                  </a>
                ))}
                
                {contentData.overview.posts.length === 0 && (
                  <div class="col-span-full text-center py-12">
                    <p class="text-gray-500 text-lg">No blog posts available yet.</p>
                    <p class="text-gray-400 text-sm mt-2">Check back soon for updates!</p>
                  </div>
                )}
              </div>
            </div>

            <!-- Research content -->
            <div id="research-content" class="tab-content hidden">
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                {contentData.research.posts.map(post => (
                  <a href={`/blog/${post.slug}`} class="block group blog-card">
                    <div class="mb-6">
                      <img 
                        src="/assets/images/image.png"
                        loading="lazy"
                        alt={post.title}
                        class="w-full h-48 object-cover rounded-lg"
                      />
                    </div>
                    <div class="space-y-3">
                      <h2 class="text-xl font-bold text-gray-900 leading-snug group-hover:text-primary transition-colors duration-200" style="font-family: 'GT Alpina Fine', serif;">
                        {post.title}
                      </h2>
                      <p class="text-gray-600 text-sm leading-relaxed line-clamp-3">
                        {post.excerpt}
                      </p>
                    </div>
                  </a>
                ))}
              </div>
            </div>

            <!-- Events content -->
            <div id="events-content" class="tab-content hidden">
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                {contentData.events.posts.map(post => (
                  <a href={`/blog/${post.slug}`} class="block group blog-card">
                    <div class="mb-6">
                      <img 
                        src="/assets/images/image.png"
                        loading="lazy"
                        alt={post.title}
                        class="w-full h-48 object-cover rounded-lg"
                      />
                    </div>
                    <div class="space-y-3">
                      <h2 class="text-xl font-bold text-gray-900 leading-snug group-hover:text-primary transition-colors duration-200" style="font-family: 'GT Alpina Fine', serif;">
                        {post.title}
                      </h2>
                      <p class="text-gray-600 text-sm leading-relaxed line-clamp-3">
                        {post.excerpt}
                      </p>
                    </div>
                  </a>
                ))}
              </div>
            </div>

            <!-- News content -->
            <div id="news-content" class="tab-content hidden">
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                {contentData.news.posts.map(post => (
                  <a href={`/blog/${post.slug}`} class="block group blog-card">
                    <div class="mb-6">
                      <img 
                        src="/assets/images/image.png"
                        loading="lazy"
                        alt={post.title}
                        class="w-full h-48 object-cover rounded-lg"
                      />
                    </div>
                    <div class="space-y-3">
                      <h2 class="text-xl font-bold text-gray-900 leading-snug group-hover:text-primary transition-colors duration-200" style="font-family: 'GT Alpina Fine', serif;">
                        {post.title}
                      </h2>
                      <p class="text-gray-600 text-sm leading-relaxed line-clamp-3">
                        {post.excerpt}
                      </p>
                    </div>
                  </a>
                ))}
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <style>
      .line-clamp-3 {
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }
      
      /* Hide scrollbar for tab navigation */
      .overflow-x-auto {
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none; /* Internet Explorer 10+ */
      }
      
      .overflow-x-auto::-webkit-scrollbar {
        display: none; /* WebKit */
      }
      
      /* Smooth scrolling for tabs */
      .overflow-x-auto {
        scroll-behavior: smooth;
      }
      
      /* Ensure tabs don't shrink on mobile */
      @media (max-width: 768px) {
        .flex.justify-center.min-w-max {
          justify-content: flex-start;
          padding: 0 1rem;
        }
      }
    </style>

    <script is:inline>
      document.addEventListener('DOMContentLoaded', () => {
        const loadingScreen = document.getElementById('loading-screen');
        const mainContent = document.getElementById('main-content');

        // Check if this is a back navigation
        const isBackNavigation = sessionStorage.getItem('alife-back-navigation') === 'true';
        const isFromBlogPage = sessionStorage.getItem('alife-from-blog-page') === 'true';
        
        if (isBackNavigation && isFromBlogPage) {
          // Show slide animation for back navigation from blog pages
          const blogContent = document.getElementById('blog-content');
          
          if (loadingScreen && mainContent && blogContent) {
            // Hide loader immediately
            loadingScreen.style.display = 'none';
            mainContent.classList.remove('hidden');
            mainContent.classList.remove('opacity-0');
            
            // Add slide animation classes
            blogContent.classList.add('slide-in-from-left');
            
            // Trigger animation
            setTimeout(() => {
              blogContent.classList.add('animate');
            }, 50);
          }
          
          // Clear the navigation flags
          sessionStorage.removeItem('alife-back-navigation');
          sessionStorage.removeItem('alife-from-blog-page');
        } else if (isBackNavigation) {
          // Skip loader for other back navigation
          if (loadingScreen && mainContent) {
            loadingScreen.style.display = 'none';
            mainContent.classList.remove('hidden');
            mainContent.classList.remove('opacity-0');
          }
          
          // Clear the back navigation flag
          sessionStorage.removeItem('alife-back-navigation');
        } else if (loadingScreen && mainContent) {
          // Normal loading animation for fresh page loads
          setTimeout(() => {
            loadingScreen.style.transform = 'translateY(-100%)';
            setTimeout(() => {
              loadingScreen.style.display = 'none';
              mainContent.classList.remove('hidden');
              setTimeout(() => {
                mainContent.classList.remove('opacity-0');
              }, 50);
            }, 700);
          }, 2000);
        }

        // Tab functionality
        const tabs = document.querySelectorAll('.tab, .active-tab');
        const tabContents = document.querySelectorAll('.tab-content');

        function showTab(tabName) {
          // Hide all tab contents
          tabContents.forEach((content) => {
            content.classList.add('hidden');
            // Remove animation classes from cards in hidden tabs
            const cards = content.querySelectorAll('.blog-card');
            cards.forEach(card => {
              card.classList.remove('animate');
            });
          });

          // Show selected tab content
          const selectedContent = document.getElementById(`${tabName}-content`);
          if (selectedContent) {
            selectedContent.classList.remove('hidden');
            
            // Animate cards in the selected tab
            const cards = selectedContent.querySelectorAll('.blog-card');
            cards.forEach((card, index) => {
              // Reset animation delay for each card
              card.style.transitionDelay = `${(index + 1) * 0.1}s`;
              // Trigger animation
              setTimeout(() => {
                card.classList.add('animate');
              }, 50);
            });
          }
        }

        tabs.forEach((tab) => {
          tab.addEventListener('click', function () {
            // Update tab styling
            tabs.forEach((t) => {
              t.classList.remove('active-tab', 'bg-primary', 'text-white');
              t.classList.add('tab', 'text-primary');
            });

            this.classList.remove('tab', 'text-primary');
            this.classList.add('active-tab', 'bg-primary', 'text-white');

            // Get tab name from ID
            const tabName = this.id.replace('-tab', '');
            showTab(tabName);
          });
        });

        // Initialize with overview tab
        showTab('overview');
        
        // Animate initial cards after page load
        setTimeout(() => {
          const overviewContent = document.getElementById('overview-content');
          if (overviewContent) {
            const cards = overviewContent.querySelectorAll('.blog-card');
            cards.forEach((card, index) => {
              card.style.transitionDelay = `${(index + 1) * 0.1}s`;
              setTimeout(() => {
                card.classList.add('animate');
              }, 50);
            });
          }
        }, 100);
      });
    </script>
  </body>
</html>

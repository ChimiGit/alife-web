---
import '../styles/global.css';
import Header from '../components/Header.astro';
import BlogLoading from '../components/ui/loaders/BlogLoading.astro';
import { getAllBlogs, getBlogsByCategory, getAllCategories } from '../utils/blog';

const urlParams = new URLSearchParams(Astro.url.search);
const lang = urlParams.get('lang') || 'en';
const translations = {
  en: {
    navigation: {
      about: 'About', career: 'Career', blog: 'Blog', support: 'Support Us'
    }
  },
  jp: {
    navigation: {
      about: '概要', career: 'キャリア', blog: 'ブログ', support: 'サポート'
    }
  }
};

const t = translations[lang as keyof typeof translations] || translations.en;

// Get actual blog posts and categories
const allBlogs = getAllBlogs();
const categories = getAllCategories();

// Create content data based on actual blog posts
const contentData = {
  overview: {
    posts: allBlogs.map((blog, index) => ({
      id: index + 1,
      title: blog.title,
      excerpt: blog.description,
      category: blog.category,
      slug: blog.slug,
      pubDate: blog.pubDate,
      author: blog.author,
      tags: blog.tags || []
    })),
  },
  research: {
    posts: getBlogsByCategory('Research').map((blog, index) => ({
      id: index + 1,
      title: blog.title,
      excerpt: blog.description,
      category: blog.category,
      slug: blog.slug,
      pubDate: blog.pubDate,
      author: blog.author,
      tags: blog.tags || []
    })),
  },
  events: {
    posts: getBlogsByCategory('Events').map((blog, index) => ({
      id: index + 1,
      title: blog.title,
      excerpt: blog.description,
      category: blog.category,
      slug: blog.slug,
      pubDate: blog.pubDate,
      author: blog.author,
      tags: blog.tags || []
    })),
  },
  news: {
    posts: getBlogsByCategory('News').map((blog, index) => ({
      id: index + 1,
      title: blog.title,
      excerpt: blog.description,
      category: blog.category,
      slug: blog.slug,
      pubDate: blog.pubDate,
      author: blog.author,
      tags: blog.tags || []
    })),
  }
};
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>Blog - ALIFE</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  </head>
  <body class="min-h-screen bg-gray-50">
    <div id="loading-screen" class="fixed inset-0 z-50 transition-all duration-700 ease-in-out">
      <BlogLoading />
    </div>

    <div id="main-content" class="opacity-0 transition-opacity duration-500 ease-in hidden">
      <Header lang={lang} translations={t} />

      <main class="max-w-7xl mx-auto px-4 py-12" style="font-family: 'Inter', sans-serif;">
        <div class="text-center mb-12">
          <h1 class="text-4xl md:text-5xl font-bold text-primary mb-4" style="font-family: 'GT Alpina Fine', serif;">Sharing Our Journey</h1>
          <p class="text-20px text-gray-600 max-w-4xl mx-auto">
            Research breakthroughs, upcoming events, and latest news from the frontier of evolutionary AI
          </p>
        </div>

        <div class="flex justify-center mb-8">
          <div class="flex bg-gray-100 rounded-full p-1">
            <button id="overview-tab" class="active-tab px-6 py-2 rounded-full bg-primary text-white font-medium transition-all duration-200">
              Overview
            </button>
            <button id="research-tab" class="tab px-6 py-2 rounded-full text-primary hover:bg-gray-200 font-medium transition-all duration-200">
              Research
            </button>
            <button id="events-tab" class="tab px-6 py-2 rounded-full text-primary hover:bg-gray-200 font-medium transition-all duration-200">
              Events
            </button>
            <button id="news-tab" class="tab px-6 py-2 rounded-full text-primary hover:bg-gray-200 font-medium transition-all duration-200">
              News
            </button>
          </div>
        </div>

        <div class="w-full">
          <div id="tab-content" class="w-full">
            <!-- Overview content (default) -->
            <div id="overview-content" class="tab-content">
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                {contentData.overview.posts.map(post => (
                  <a href={`/blog/${post.slug}`} class="block">
                    <article class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-all duration-300 hover:scale-105 cursor-pointer">
                      <div class="aspect-w-16 aspect-h-9">
                        <img 
                          src={[
                            "/assets/images/Blog Loading.png",
                            "/assets/images/About Loading.png", 
                            "/assets/images/Career Loading.png",
                            "/assets/images/Support Us Loading.png"
                          ][post.id % 4]} 
                          alt={post.title}
                          class="w-full h-48 object-cover"
                        />
                      </div>
                      <div class="p-6">
                        <h2 class="text-xl font-bold text-gray-900 mb-3 leading-tight hover:text-primary transition-colors duration-200" style="font-family: 'GT Alpina Fine', serif;">
                          {post.title}
                        </h2>
                        <p class="text-gray-600 text-sm leading-relaxed line-clamp-3">
                          {post.excerpt}
                        </p>
                      </div>
                    </article>
                  </a>
                ))}
                
                {contentData.overview.posts.length === 0 && (
                  <div class="col-span-full text-center py-12">
                    <p class="text-gray-500 text-lg">No blog posts available yet.</p>
                    <p class="text-gray-400 text-sm mt-2">Check back soon for updates!</p>
                  </div>
                )}
              </div>
            </div>

            <!-- Research content -->
            <div id="research-content" class="tab-content hidden">
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                {contentData.research.posts.map(post => (
                  <a href={`/blog/${post.slug}`} class="block">
                    <article class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-all duration-300 hover:scale-105 cursor-pointer">
                      <div class="aspect-w-16 aspect-h-9">
                        <img 
                          src={[
                            "/assets/images/Blog Loading.png",
                            "/assets/images/About Loading.png", 
                            "/assets/images/Career Loading.png",
                            "/assets/images/Support Us Loading.png"
                          ][post.id % 4]} 
                          alt={post.title}
                          class="w-full h-48 object-cover"
                        />
                      </div>
                      <div class="p-6">
                        <h2 class="text-xl font-bold text-gray-900 mb-3 leading-tight hover:text-primary transition-colors duration-200" style="font-family: 'GT Alpina Fine', serif;">
                          {post.title}
                        </h2>
                        <p class="text-gray-600 text-sm leading-relaxed line-clamp-3">
                          {post.excerpt}
                        </p>
                      </div>
                    </article>
                  </a>
                ))}
              </div>
            </div>

            <!-- Events content -->
            <div id="events-content" class="tab-content hidden">
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                {contentData.events.posts.map(post => (
                  <a href={`/blog/${post.slug}`} class="block">
                    <article class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-all duration-300 hover:scale-105 cursor-pointer">
                      <div class="aspect-w-16 aspect-h-9">
                        <img 
                          src={[
                            "/assets/images/Blog Loading.png",
                            "/assets/images/About Loading.png", 
                            "/assets/images/Career Loading.png",
                            "/assets/images/Support Us Loading.png"
                          ][post.id % 4]} 
                          alt={post.title}
                          class="w-full h-48 object-cover"
                        />
                      </div>
                      <div class="p-6">
                        <h2 class="text-xl font-bold text-gray-900 mb-3 leading-tight hover:text-primary transition-colors duration-200" style="font-family: 'GT Alpina Fine', serif;">
                          {post.title}
                        </h2>
                        <p class="text-gray-600 text-sm leading-relaxed line-clamp-3">
                          {post.excerpt}
                        </p>
                      </div>
                    </article>
                  </a>
                ))}
              </div>
            </div>

            <!-- News content -->
            <div id="news-content" class="tab-content hidden">
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                {contentData.news.posts.map(post => (
                  <a href={`/blog/${post.slug}`} class="block">
                    <article class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-all duration-300 hover:scale-105 cursor-pointer">
                      <div class="aspect-w-16 aspect-h-9">
                        <img 
                          src={[
                            "/assets/images/Blog Loading.png",
                            "/assets/images/About Loading.png", 
                            "/assets/images/Career Loading.png",
                            "/assets/images/Support Us Loading.png"
                          ][post.id % 4]} 
                          alt={post.title}
                          class="w-full h-48 object-cover"
                        />
                      </div>
                      <div class="p-6">
                        <h2 class="text-xl font-bold text-gray-900 mb-3 leading-tight hover:text-primary transition-colors duration-200" style="font-family: 'GT Alpina Fine', serif;">
                          {post.title}
                        </h2>
                        <p class="text-gray-600 text-sm leading-relaxed line-clamp-3">
                          {post.excerpt}
                        </p>
                      </div>
                    </article>
                  </a>
                ))}
              </div>
            </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <style>
      .line-clamp-3 {
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }
      
      .aspect-w-16 {
        position: relative;
        padding-bottom: 56.25%; /* 16:9 aspect ratio */
      }
      
      .aspect-w-16 img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
    </style>

    <script is:inline>
      document.addEventListener('DOMContentLoaded', () => {
        const loadingScreen = document.getElementById('loading-screen');
        const mainContent = document.getElementById('main-content');

        if (loadingScreen && mainContent) {
          setTimeout(() => {
            loadingScreen.style.transform = 'translateY(-100%)';
            setTimeout(() => {
              loadingScreen.style.display = 'none';
              mainContent.classList.remove('hidden');
              setTimeout(() => {
                mainContent.classList.remove('opacity-0');
              }, 50);
            }, 700);
          }, 2000);
        }

        // Tab functionality
        const tabs = document.querySelectorAll('.tab, .active-tab');
        const tabContents = document.querySelectorAll('.tab-content');

        function showTab(tabName) {
          // Hide all tab contents
          tabContents.forEach((content) => {
            content.classList.add('hidden');
          });

          // Show selected tab content
          const selectedContent = document.getElementById(`${tabName}-content`);
          if (selectedContent) {
            selectedContent.classList.remove('hidden');
          }
        }

        tabs.forEach((tab) => {
          tab.addEventListener('click', function () {
            // Update tab styling
            tabs.forEach((t) => {
              t.classList.remove('active-tab', 'bg-primary', 'text-white');
              t.classList.add('tab', 'text-primary');
            });

            this.classList.remove('tab', 'text-primary');
            this.classList.add('active-tab', 'bg-primary', 'text-white');

            // Get tab name from ID
            const tabName = this.id.replace('-tab', '');
            showTab(tabName);
          });
        });

        // Initialize with overview tab
        showTab('overview');
      });
    </script>
  </body>
</html>

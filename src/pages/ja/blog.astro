---
import '../../styles/global.css';
import Header from '../../components/Header.astro';
import getAllBlogs, { getBlogsByCategory } from '../../utils/blog.ts';
import { t, type Locale } from '../../utils/i18n.ts';

const currentLocale: Locale = 'ja';

// Get actual blog posts and categories
const allBlogs = getAllBlogs();

// Create content data based on actual blog posts
const contentData = {
  overview: {
    posts: allBlogs.map((blog, index) => ({
      id: index + 1,
      title: blog.title,
      excerpt: blog.description,
      category: blog.category,
      slug: blog.slug,
      pubDate: blog.pubDate,
      author: blog.author,
      tags: blog.tags || []
    })),
  },
  research: {
    posts: getBlogsByCategory('Research').map((blog, index) => ({
      id: index + 1,
      title: blog.title,
      excerpt: blog.description,
      category: blog.category,
      slug: blog.slug,
      pubDate: blog.pubDate,
      author: blog.author,
      tags: blog.tags || []
    })),
  },
  events: {
    posts: getBlogsByCategory('Events').map((blog, index) => ({
      id: index + 1,
      title: blog.title,
      excerpt: blog.description,
      category: blog.category,
      slug: blog.slug,
      pubDate: blog.pubDate,
      author: blog.author,
      tags: blog.tags || []
    })),
  },
  news: {
    posts: getBlogsByCategory('News').map((blog, index) => ({
      id: index + 1,
      title: blog.title,
      excerpt: blog.description,
      category: blog.category,
      slug: blog.slug,
      pubDate: blog.pubDate,
      author: blog.author,
      tags: blog.tags || []
    })),
  }
};
---

<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>ブログ - ALIFE</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
    /* Slide-in animation styles for back navigation from blog pages */
    .slide-in-from-left {
      transform: translateX(-100%);
      opacity: 0;
      transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.6s ease-out;
    }

    .slide-in-from-left.animate {
      transform: translateX(0);
      opacity: 1;
    }

    /* Staggered animation for child elements */
    .slide-in-from-left .hero-section,
    .slide-in-from-left .tabs-section,
    .slide-in-from-left .content-section {
      transform: translateX(-50px);
      opacity: 0;
      transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.5s ease-out;
    }

    .slide-in-from-left.animate .hero-section {
      transition-delay: 0.1s;
    }

    .slide-in-from-left.animate .tabs-section {
      transition-delay: 0.2s;
    }

    .slide-in-from-left.animate .content-section {
      transition-delay: 0.3s;
    }

    .slide-in-from-left.animate .hero-section,
    .slide-in-from-left.animate .tabs-section,
    .slide-in-from-left.animate .content-section {
      transform: translateX(0);
      opacity: 1;
    }

    /* Card animation styles for tab switching */
    .blog-card {
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.4s ease-out, transform 0.4s ease-out;
    }

    .blog-card.animate {
      opacity: 1;
      transform: translateY(0);
    }

    /* Staggered animation for cards */
    .blog-card:nth-child(1) { transition-delay: 0.1s; }
    .blog-card:nth-child(2) { transition-delay: 0.2s; }
    .blog-card:nth-child(3) { transition-delay: 0.3s; }
    .blog-card:nth-child(4) { transition-delay: 0.4s; }
    .blog-card:nth-child(5) { transition-delay: 0.5s; }
    .blog-card:nth-child(6) { transition-delay: 0.6s; }
    .blog-card:nth-child(7) { transition-delay: 0.7s; }
    .blog-card:nth-child(8) { transition-delay: 0.8s; }
    </style>
  </head>

  <body class="min-h-screen bg-gray-50 font-japanese">
    <div id="main-content">
      <Header locale={currentLocale} />

      <main id="blog-content" class="max-w-7xl mx-auto px-4 py-12 content-stagger" style="font-family: 'Inter', sans-serif;">
        <div class="text-center mb-12 hero-section">
          <h1 class="text-4xl md:text-5xl font-bold text-primary mb-4" style="font-family: 'GT Alpina Fine', serif;">{t(currentLocale, 'blog.title')}</h1>
          <p class="text-medium text-gray-600 max-w-3xl mx-auto font-light">
            {t(currentLocale, 'blog.subtitle')}
          </p>
        </div>

        <div class="mb-8 tabs-section">
          <div class="overflow-x-auto">
            <div class="flex justify-center min-w-max">
              <div class="flex bg-gray-100 rounded-full p-1 font-light text-sm">
                <button id="overview-tab" class="active-tab px-6 py-2 rounded-full bg-primary text-white transition-all duration-200 whitespace-nowrap">
                  すべて
                </button>
                <button id="research-tab" class="tab px-6 py-2 rounded-full text-primary hover:bg-gray-200 transition-all duration-200 whitespace-nowrap">
                  研究
                </button>
                <button id="events-tab" class="tab px-6 py-2 rounded-full text-primary hover:bg-gray-200 transition-all duration-200 whitespace-nowrap">
                  イベント
                </button>
                <button id="news-tab" class="tab px-6 py-2 rounded-full text-primary hover:bg-gray-200 transition-all duration-200 whitespace-nowrap">
                  ニュース
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Separator line -->
        <div class="border-b border-gray-200 mb-8"></div>

        <div class="w-full content-section">
          <div id="tab-content" class="w-full">
            <!-- Overview content (default) -->
            <div id="overview-content" class="tab-content">
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                {contentData.overview.posts.map(post => (
                  <a href={`/ja/blog/${post.slug}`} class="block group blog-card">
                    <div class="mb-6">
                      <img 
                        src="/assets/images/image.png"
                        loading="lazy"
                        alt={post.title}
                        class="w-full aspect-square object-cover"
                      />
                    </div>
                    <div class="space-y-3">
                      <h2 class="text-xl font-bold text-gray-900 leading-snug group-hover:text-primary transition-colors duration-200" style="font-family: 'GT Alpina Fine', serif;">
                        {post.title}
                      </h2>
                      <p class="text-gray-600 text-sm leading-relaxed line-clamp-3 font-light">
                        {post.excerpt}
                      </p>
                    </div>
                  </a>
                ))}
                
                {contentData.overview.posts.length === 0 && (
                  <div class="col-span-full text-center py-12">
                    <p class="text-gray-500 text-lg">ブログ記事はまだありません。</p>
                    <p class="text-gray-400 text-sm mt-2">更新をお待ちください！</p>
                  </div>
                )}
              </div>
            </div>

            <!-- Research content -->
            <div id="research-content" class="tab-content hidden">
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                {contentData.research.posts.map(post => (
                  <a href={`/ja/blog/${post.slug}`} class="block group blog-card">
                    <div class="mb-6">
                      <img 
                        src="/assets/images/image.png"
                        loading="lazy"
                        alt={post.title}
                        class="w-full aspect-square object-cover"
                      />
                    </div>
                    <div class="space-y-3">
                      <h2 class="text-xl font-bold text-gray-900 leading-snug group-hover:text-primary transition-colors duration-200" style="font-family: 'GT Alpina Fine', serif;">
                        {post.title}
                      </h2>
                      <p class="text-gray-600 text-sm leading-relaxed line-clamp-3">
                        {post.excerpt}
                      </p>
                    </div>
                  </a>
                ))}
              </div>
            </div>

            <!-- Events content -->
            <div id="events-content" class="tab-content hidden">
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                {contentData.events.posts.map(post => (
                  <a href={`/ja/blog/${post.slug}`} class="block group blog-card">
                    <div class="mb-6">
                      <img 
                        src="/assets/images/image.png"
                        loading="lazy"
                        alt={post.title}
                        class="w-full aspect-square object-cover"
                      />
                    </div>
                    <div class="space-y-3">
                      <h2 class="text-xl font-bold text-gray-900 leading-snug group-hover:text-primary transition-colors duration-200" style="font-family: 'GT Alpina Fine', serif;">
                        {post.title}
                      </h2>
                      <p class="text-gray-600 text-sm leading-relaxed line-clamp-3">
                        {post.excerpt}
                      </p>
                    </div>
                  </a>
                ))}
              </div>
            </div>

            <!-- News content -->
            <div id="news-content" class="tab-content hidden">
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                {contentData.news.posts.map(post => (
                  <a href={`/ja/blog/${post.slug}`} class="block group blog-card">
                    <div class="mb-6">
                      <img 
                        src="/assets/images/image.png"
                        loading="lazy"
                        alt={post.title}
                        class="w-full aspect-square object-cover"
                      />
                    </div>
                    <div class="space-y-3">
                      <h2 class="text-xl font-bold text-gray-900 leading-snug group-hover:text-primary transition-colors duration-200" style="font-family: 'GT Alpina Fine', serif;">
                        {post.title}
                      </h2>
                      <p class="text-gray-600 text-sm leading-relaxed line-clamp-3">
                        {post.excerpt}
                      </p>
                    </div>
                  </a>
                ))}
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <style>
      .line-clamp-3 {
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }
    </style>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // Tab functionality
        const tabs = document.querySelectorAll('.tab, .active-tab');
        const tabContents = document.querySelectorAll('.tab-content');

        tabs.forEach(tab => {
          tab.addEventListener('click', () => {
            // Remove active class from all tabs
            tabs.forEach(t => {
              t.classList.remove('active-tab', 'bg-primary', 'text-white');
              t.classList.add('tab', 'text-primary');
            });

            // Add active class to clicked tab
            tab.classList.remove('tab', 'text-primary');
            tab.classList.add('active-tab', 'bg-primary', 'text-white');

            // Hide all tab contents
            tabContents.forEach(content => content.classList.add('hidden'));

            // Show corresponding content
            const tabId = tab.id.replace('-tab', '');
            const targetContent = document.getElementById(`${tabId}-content`);
            if (targetContent) {
              targetContent.classList.remove('hidden');
              
              // Animate cards
              const cards = targetContent.querySelectorAll('.blog-card');
              cards.forEach((card, index) => {
                setTimeout(() => {
                  card.classList.add('animate');
                }, index * 100);
              });
            }
          });
        });

        // Initialize content animations
        setTimeout(() => {
          const staggerContainer = document.querySelector('.content-stagger');
          if (staggerContainer) {
            staggerContainer.classList.add('loaded');
          }
        }, 100);

        // Language preference handling
        const storedLocale = localStorage.getItem('alife-locale');
        const currentPath = window.location.pathname;
        
        // If user has a stored preference, redirect to the appropriate localized path
        if (storedLocale) {
          if (storedLocale === 'ja' && !currentPath.startsWith('/alife-web/ja/')) {
            // Redirect to Japanese version
            window.location.href = `/alife-web/ja${currentPath.replace('/alife-web', '')}`;
          } else if (storedLocale === 'en' && currentPath.startsWith('/alife-web/ja/')) {
            // Redirect to English version (remove /ja prefix)
            const englishPath = currentPath.replace('/alife-web/ja', '/alife-web');
            window.location.href = englishPath;
          }
        }
      });
    </script>
  </body>
</html>
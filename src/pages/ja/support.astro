---
import Header from '../../components/Header.astro';
import '../../styles/global.css';
import { getAllSupportCategories, getAllSupportTeamMembers } from '../../utils/support.ts';
import { t, type Locale } from '../../utils/i18n.ts';

const currentLocale: Locale = 'ja';
const supportCategories = await getAllSupportCategories();
const supportTeamMembers = await getAllSupportTeamMembers();
---

<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/png" href="/assets/logo/thumbnail-logo.png" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>サポート - ALIFE</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  </head>
  <body class="min-h-screen bg-gray-50 font-japanese">
    <!-- Main Content -->
    <div id="main-content">
      <Header locale={currentLocale} />

      <!-- Main content -->
      <main class="pt-10 sm:pt-10 content-stagger" style="font-family: 'Inter', sans-serif;">
        <!-- Hero Section -->
        <section class="pb-12 sm:pb-16 md:py-20">
          <div class="max-w-6xl mx-auto px-4 sm:px-6 text-center">
            <h1 class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl text-primary mb-6 sm:mb-8 leading-tight" style="font-family: 'GT Alpina Fine', serif;">
              {t(currentLocale, 'support.title')}
            </h1>
            <p class="text-gray-700 max-w-5xl mx-auto leading-relaxed px-4 sm:px-6 font-light" style="font-family: 'Inter', sans-serif; line-height: 2; font-size: 16px;">
              {t(currentLocale, 'support.subtitle')}
            </p>
            <!-- Divider -->
            <div class="h-px w-100% bg-primary mx-auto mt-8"></div>
          </div>
        </section>

        <!-- Main Content Section -->
        <section class="py-12 sm:py-16 md:py-20">
          <div class="max-w-6xl mx-auto px-4 sm:px-6">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 sm:gap-12 lg:gap-16">
              
              <!-- Left Sidebar Navigation -->
              <div class="lg:col-span-1">
                <nav class="space-y-2" role="tablist" aria-orientation="vertical">
                  {supportCategories && supportCategories.length > 0 ? (
                    supportCategories.map((category, index) => (
                      <button
                        type="button"
                        class={`support-tab w-full text-left py-3 px-4 text-lg border-l-4 hover:text-primary ${index === 0 ? 'active font-semibold text-primary border-primary bg-gray-100' : 'text-gray-500 border-transparent'}`}
                        id={`${category.slug}-tab`}
                        aria-selected={index === 0 ? 'true' : 'false'}
                        data-target={`#${category.slug}-panel`}
                        role="tab"
                        style="font-family: 'GT Alpina Fine', sans-serif;"
                      >
                        {category.title}
                      </button>
                    ))
                  ) : (
                    <div class="text-gray-500 text-sm">サポートカテゴリがありません</div>
                  )}
                  <button
                    type="button"
                    class="support-tab w-full text-left py-3 px-4 text-lg border-l-4 text-gray-500 border-transparent hover:text-primary"
                    id="contact-tab"
                    aria-selected="false"
                    data-target="#contact-panel"
                    role="tab"
                    style="font-family: 'GT Alpina Fine', sans-serif;"
                  >
                    {t(currentLocale, 'support.contact')}
                  </button>
                </nav>
              </div>

              <!-- Right Content Area -->
              <div class="lg:col-span-2">
                {supportCategories && supportCategories.length > 0 ? (
                  supportCategories.map((category, index) => (
                    <div
                      id={`${category.slug}-panel`}
                      class={`support-panel ${index === 0 ? '' : 'hidden'}`}
                      role="tabpanel"
                      aria-labelledby={`${category.slug}-tab`}
                    >
                      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                        {supportTeamMembers && supportTeamMembers.filter(member => member.category === category.slug).length > 0 ? (
                          supportTeamMembers.filter(member => member.category === category.slug).sort((a, b) => a.order - b.order).map(member => (
                            <div class="text-center group cursor-pointer" onclick={`showSupportMemberDetails('${member.slug}')`}>
                              <div class="w-48 h-48 mx-auto mb-4 rounded-medium overflow-hidden bg-gray-200 group-hover:shadow-lg transition-all duration-300">
                                <img src={member.image} alt={member.name} class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
                              </div>
                              <h3 class="text-lg font-semibold text-primary mb-2" style="font-family: 'GT Alpina Fine', sans-serif;">
                                {member.name}
                              </h3>
                              <p class="text-sm text-gray-600 font-light">
                                {member.title}
                              </p>
                            </div>
                          ))
                        ) : (
                          <div class="col-span-full text-center py-12">
                            <p class="text-gray-500 text-lg">このカテゴリにはメンバーがいません。</p>
                            <p class="text-gray-400 text-sm mt-2">後日更新をお待ちください！</p>
                          </div>
                        )}
                      </div>
                    </div>
                  ))
                ) : (
                  <div class="text-center py-12">
                    <p class="text-gray-500 text-lg">サポートカテゴリがありません。</p>
                    <p class="text-gray-400 text-sm mt-2">後日更新をお待ちください！</p>
                  </div>
                )}

                <!-- Contact Panel -->
                <div id="contact-panel" class="support-panel hidden" role="tabpanel" aria-labelledby="contact-tab">
                  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-8">
                    <h2 class="text-2xl font-bold text-primary mb-6" style="font-family: 'GT Alpina Fine', serif;">
                      {t(currentLocale, 'support.contact')}
                    </h2>
                    
                    <div class="space-y-6">
                      <!-- Contact Information -->
                      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="text-center">
                          <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
                            <img src="/assets/images/email.svg" alt="Email" class="w-8 h-8 filter-primary">
                          </div>
                          <h3 class="font-semibold text-primary mb-2">Email</h3>
                          <p class="text-sm text-gray-600">support@alife.ai</p>
                        </div>
                        
                        <div class="text-center">
                          <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
                            <img src="/assets/images/property-location.svg" alt="Location" class="w-8 h-8 filter-primary">
                          </div>
                          <h3 class="font-semibold text-primary mb-2">Location</h3>
                          <p class="text-sm text-gray-600">Tokyo, Japan</p>
                        </div>
                        
                        <div class="text-center">
                          <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
                            <img src="/assets/images/mobile-chat.svg" alt="Phone" class="w-8 h-8 filter-primary">
                          </div>
                          <h3 class="font-semibold text-primary mb-2">Phone</h3>
                          <p class="text-sm text-gray-600">+81-3-1234-5678</p>
                        </div>
                      </div>

                      <!-- Contact Form -->
                      <div class="mt-8">
                        <h3 class="text-lg font-semibold text-primary mb-4">お問い合わせフォーム</h3>
                        <form class="space-y-4">
                          <div>
                            <label for="name" class="block text-sm font-medium text-primary mb-2">お名前</label>
                            <input 
                              type="text" 
                              id="name" 
                              name="name" 
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200 text-gray-900 placeholder-gray-500"
                              placeholder="お名前を入力してください"
                            >
                          </div>
                          
                          <div>
                            <label for="email" class="block text-sm font-medium text-primary mb-2">メールアドレス</label>
                            <input 
                              type="email" 
                              id="email" 
                              name="email" 
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200 text-gray-900 placeholder-gray-500"
                              placeholder="メールアドレスを入力してください"
                            >
                          </div>
                          
                          <div>
                            <label for="message" class="block text-sm font-medium text-primary mb-2">メッセージ</label>
                            <textarea 
                              id="message" 
                              name="message" 
                              rows="6" 
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200 text-gray-900 placeholder-gray-500 resize-vertical" 
                              placeholder="メッセージを入力してください"
                            ></textarea>
                          </div>
                          
                          <!-- Submit Button -->
                          <div class="flex justify-end">
                            <button 
                              type="submit" 
                              class="bg-primary text-white px-6 py-2 rounded-lg font-normal text-sm hover:bg-primary transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2"
                            >
                              送信
                            </button>
                          </div>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- Support Member Modal -->
    <div id="support-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
      <div class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
          <div class="p-6">
            <div class="flex justify-between items-center mb-4">
              <h2 class="text-2xl font-bold text-primary" style="font-family: 'GT Alpina Fine', sans-serif;">
                メンバー詳細
              </h2>
              <button onclick="closeSupportModal()" class="text-gray-500 hover:text-gray-700">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
              </button>
            </div>
            <div id="support-modal-content" class="text-primary space-y-6">
              <!-- Markdown content will be inserted here -->
            </div>
            <div class="mt-8 flex justify-end">
              <button onclick="closeSupportModal()" class="px-6 py-2 bg-primary text-white rounded-full font-medium hover:bg-primary transition-colors duration-200">
                {t(currentLocale, 'common.close')}
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // Support tab functionality
        const supportTabs = document.querySelectorAll('.support-tab');
        const supportPanels = document.querySelectorAll('.support-panel');

        supportTabs.forEach(tab => {
          tab.addEventListener('click', () => {
            // Remove active class from all tabs
            supportTabs.forEach(t => {
              t.classList.remove('active', 'font-semibold', 'text-primary', 'border-primary', 'bg-gray-100');
              t.classList.add('text-gray-500', 'border-transparent');
            });

            // Add active class to clicked tab
            tab.classList.add('active', 'font-semibold', 'text-primary', 'border-primary', 'bg-gray-100');
            tab.classList.remove('text-gray-500', 'border-transparent');

            // Hide all panels
            supportPanels.forEach(panel => panel.classList.add('hidden'));

            // Show corresponding panel
            const targetId = tab.getAttribute('data-target');
            if (targetId) {
              const targetPanel = document.querySelector(targetId);
              if (targetPanel) {
                targetPanel.classList.remove('hidden');
              }
            }
          });
        });

        // Initialize content animations
        setTimeout(() => {
          const staggerContainer = document.querySelector('.content-stagger');
          if (staggerContainer) {
            staggerContainer.classList.add('loaded');
          }
        }, 100);

        // Language preference handling
        const storedLocale = localStorage.getItem('alife-locale');
        const currentPath = window.location.pathname;
        
        // If user has a stored preference, redirect to the appropriate localized path
        if (storedLocale) {
          if (storedLocale === 'ja' && !currentPath.startsWith('/ja/')) {
            // Redirect to Japanese version
            window.location.href = `/ja${currentPath}`;
          } else if (storedLocale === 'en' && currentPath.startsWith('/ja/')) {
            // Redirect to English version (remove /ja prefix)
            const englishPath = currentPath.replace('/ja', '');
            window.location.href = englishPath;
          }
        }
      });

      // eslint-disable-next-line @typescript-eslint/no-unused-vars
      function showSupportMemberDetails(slug: string) {
        // This would typically fetch member details from an API
        // For now, we'll just show a placeholder
        const modal = document.getElementById('support-modal') as HTMLElement | null;
        const modalContent = document.getElementById('support-modal-content') as HTMLElement | null;
        
        if (modalContent) {
          modalContent.innerHTML = `
            <div class="text-center">
              <h3 class="text-xl font-semibold text-primary mb-4">メンバー詳細</h3>
              <p class="text-gray-600">${slug} の詳細情報を読み込み中...</p>
            </div>
          `;
        }
        
        if (modal) {
          modal.classList.remove('hidden');
        }
      }

      // eslint-disable-next-line @typescript-eslint/no-unused-vars
      function closeSupportModal() {
        const modal = document.getElementById('support-modal') as HTMLElement | null;
        if (modal) {
          modal.classList.add('hidden');
        }
      }
    </script>
  </body>
</html>
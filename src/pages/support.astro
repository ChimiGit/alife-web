---
import Header from '../components/Header.astro';
import '../styles/global.css';
import { getAllSupportCategories, getAllSupportTeamMembers } from '../utils/support.ts';
import { t, getEffectiveLocale } from '../utils/i18n.ts';

const currentLocale = getEffectiveLocale(Astro.url.pathname);
const supportCategories = await getAllSupportCategories();
const supportTeamMembers = await getAllSupportTeamMembers();
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/png" href={`${import.meta.env.BASE_URL}assets/logo/thumbnail-logo.png`} />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>Support Us - ALIFE</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
      /* Noise effect */
      .noise-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 1;
        opacity: 0.15;
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        animation: noise 0.2s infinite;
        mix-blend-mode: overlay;
      }
      
      @keyframes noise {
        0%, 100% { transform: translate(0, 0); }
        10% { transform: translate(-5%, -5%); }
        20% { transform: translate(-10%, 5%); }
        30% { transform: translate(5%, -10%); }
        40% { transform: translate(-5%, 15%); }
        50% { transform: translate(-10%, 5%); }
        60% { transform: translate(15%, 0%); }
        70% { transform: translate(0%, 15%); }
        80% { transform: translate(-15%, 10%); }
        90% { transform: translate(10%, 5%); }
      }
    </style>
  </head>
  <body class="min-h-screen bg-gray-50">
    <!-- Noise overlay -->
    <div class="noise-overlay"></div>
    <!-- Main Content -->
    <div id="main-content">
      <Header locale={currentLocale} />

      <!-- Main content -->
      <main class="pt-10 sm:pt-10 content-stagger" style="font-family: 'Inter', sans-serif;">
        <!-- Hero Section -->
        <section class="pb-12 sm:pb-16 md:py-20">
          <div class="max-w-6xl mx-auto px-4 sm:px-6 text-center">
            <h1 class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl text-primary mb-6 sm:mb-8 leading-tight" style="font-family: 'GT Alpina Fine', serif;">
              {t(currentLocale, 'support.title')}
            </h1>
            <p class="text-gray-700 max-w-5xl mx-auto leading-relaxed px-4 sm:px-6 font-light" style="font-family: 'Inter', sans-serif; line-height: 2; font-size: 16px;">
              {t(currentLocale, 'support.subtitle')}
            </p>
            <!-- Divider -->
            <div class="h-px w-100% bg-primary mx-auto mt-8"></div>
          </div>
        </section>

        <!-- Main Content Section -->
        <section class="py-12 sm:py-16 md:py-20">
          <div class="max-w-6xl mx-auto px-4 sm:px-6">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 sm:gap-12 lg:gap-16">
              
              <!-- Left Sidebar Navigation -->
              <div class="lg:col-span-1">
                <nav class="space-y-2" role="tablist" aria-orientation="vertical">
                  {supportCategories && supportCategories.length > 0 ? (
                    supportCategories.map((category, index) => (
                      <button
                        type="button"
                        class={`support-tab w-full text-left py-3 px-4 text-40px hover:text-primary ${index === 0 ? 'active font-semibold text-primary border-primary bg-gray-100' : 'text-gray-500 border-transparent'}`}
                        id={`${category.slug}-tab`}
                        aria-selected={index === 0 ? 'true' : 'false'}
                        data-target={`#${category.slug}-panel`}
                        role="tab"
                        style="font-family: 'GT Alpina Fine', sans-serif;"
                      >
                        {category.title}
                      </button>
                    ))
                  ) : (
                    <div class="text-gray-500 text-sm">No support categories available</div>
                  )}
                  <button
                    type="button"
                    class="support-tab w-full text-left py-3 px-4 text-40px text-gray-500 border-transparent hover:text-primary"
                    id="contact-tab"
                    aria-selected="false"
                    data-target="#contact-panel"
                    role="tab"
                    style="font-family: 'GT Alpina Fine', sans-serif;"
                  >
                    Contact
                  </button>
                </nav>
              </div>

              <!-- Right Content Area -->
              <div class="lg:col-span-2">
                {supportCategories && supportCategories.length > 0 ? (
                  supportCategories.map((category, index) => (
                    <div
                      id={`${category.slug}-panel`}
                      class={`support-panel ${index === 0 ? '' : 'hidden'}`}
                      role="tabpanel"
                      aria-labelledby={`${category.slug}-tab`}
                    >
                      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                        {supportTeamMembers && supportTeamMembers.filter(member => member.category === category.slug).length > 0 ? (
                          supportTeamMembers.filter(member => member.category === category.slug).sort((a, b) => a.order - b.order).map(member => (
                            <div class="text-center group cursor-pointer" onclick={`showSupportMemberDetails('${member.slug}')`}>
                              <div class="w-48 h-48 mx-auto mb-4 rounded-medium overflow-hidden bg-gray-200 group-hover:shadow-lg transition-all duration-300">
                                <img src={member.image} alt={member.name} class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
                              </div>
                              <h4 class="text-xl font-bold text-primary mb-1" style="font-family: 'GT Alpina Fine', serif;">{member.name}</h4>
                              <p class="text-primary font-medium mb-1">{member.title}</p>
                              <p class="text-xs text-gray-600 mb-2">{member.bio}</p>
                              <p class="text-xs text-gray-500">{member.location}</p>
                            </div>
                          ))
                        ) : (
                          <div class="col-span-full text-center text-gray-500 py-8">
                            No team members found in this category
                          </div>
                        )}
                      </div>
                    </div>
                  ))
                ) : (
                  <div class="text-center text-gray-500 py-8">
                    <h3 class="text-xl font-semibold mb-4">Support Information Coming Soon</h3>
                    <p>Our support information is being updated. Please check back later.</p>
                  </div>
                )}

                <!-- Contact Panel -->
                <div id="contact-panel" class="support-panel hidden" role="tabpanel" aria-labelledby="contact-tab">
                  <div>
                    
                    <!-- Contact Information -->
                    <div class="space-y-8">
                      <!-- Email -->
                      <div class="flex items-start space-x-3 sm:space-x-4">
                        <div class="flex-shrink-0 w-6 h-6 sm:w-8 sm:h-8 flex items-center justify-center">
                          <img src={`${import.meta.env.BASE_URL}assets/images/email.svg`} alt="Email" class="w-4 h-4 sm:w-5 sm:h-5" />
                        </div>
                        <div>
                          <p class="text-sm sm:text-base lg:text-lg text-primary font-normal">example@teamwebflow.com</p>
                        </div>
                      </div>

                      <!-- Location -->
                      <div class="flex items-start space-x-3 sm:space-x-4">
                        <div class="flex-shrink-0 w-6 h-6 sm:w-8 sm:h-8 flex items-center justify-center">
                          <img src={`${import.meta.env.BASE_URL}assets/images/property-location.svg`} alt="Location" class="w-4 h-4 sm:w-5 sm:h-5" />
                        </div>
                        <div>
                          <p class="text-sm sm:text-base lg:text-lg text-primary font-normal">Kyoto HQ, Japan</p>
                        </div>
                      </div>

                      <!-- Phone -->
                      <div class="flex items-start space-x-3 sm:space-x-4">
                        <div class="flex-shrink-0 w-6 h-6 sm:w-8 sm:h-8 flex items-center justify-center">
                          <img src={`${import.meta.env.BASE_URL}assets/images/mobile-chat.svg`} alt="Phone" class="w-4 h-4 sm:w-5 sm:h-5" />
                        </div>
                        <div>
                          <p class="text-sm sm:text-base lg:text-lg text-primary font-normal">+44 123 654 7890</p>
                        </div>
                      </div>
                    </div>

                    <!-- Contact Form -->
                    <div class="mt-8">
                      <form class="space-y-6">
                        <!-- Name Field -->
                        <div>
                          <label for="name" class="block text-sm font-normal text-gray-700 mb-2">
                            Name <span class="text-red-500">*</span>
                          </label>
                          <input
                            type="text"
                            id="name"
                            name="name "
                            required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200 text-gray-900 placeholder-gray-500"
                            placeholder="Name"
                            >
                        </div>

                        <!-- Email Field -->
                        <div>
                          <label for="email" class="block text-sm font-normal text-gray-700 mb-2">
                            Email <span class="text-red-500">*</span>
                          </label>
                          <input
                            type="email"
                            id="email"
                            name="email"
                            required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200 text-gray-900 placeholder-gray-500"
                            placeholder="Email"
                            >
                        </div>

                        <!-- Message Field -->
                        <div>
                          <label for="message" class="block text-sm font-normal text-gray-700 mb-2">
                            Message
                          </label>
                          <textarea
                            id="message"
                            name="message"
                            rows="6"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200 text-gray-900 placeholder-gray-500 resize-vertical"
                            placeholder="Message"
                          ></textarea>
                        </div>

                        <!-- Submit Button -->
                        <div class="flex justify-end">
                          <button
                            type="submit"
                            class="bg-primary text-white px-6 py-2 rounded-lg font-normal text-sm hover:bg-primary transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2"
                          >
                            Submit
                          </button>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- Support tabs functionality -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // Support tabs functionality
        const supportTabs = document.querySelectorAll('.support-tab');
        const supportPanels = document.querySelectorAll('.support-panel');

        supportTabs.forEach((tab) => {
          tab.addEventListener('click', () => {
            const targetId = tab.getAttribute('data-target');
            const targetPanel = targetId ? document.querySelector(targetId) : null;

            // Remove active state from all support tabs
            supportTabs.forEach((t) => {
              t.classList.remove('active', 'font-semibold', 'text-primary', 'border-primary', 'bg-gray-100');
              t.classList.add('text-gray-500', 'border-transparent');
              t.setAttribute('aria-selected', 'false');
            });

            // Hide all support panels
            supportPanels.forEach((panel) => {
              panel.classList.add('hidden');
            });

            // Add active state to clicked support tab
            tab.classList.add('active', 'font-semibold', 'text-primary', 'border-primary', 'bg-gray-100');
            tab.classList.remove('text-gray-500', 'border-transparent');
            tab.setAttribute('aria-selected', 'true');

            // Show target panel
            if (targetPanel) {
              targetPanel.classList.remove('hidden');
            }
          });
        });

        // Handle URL hash for direct tab navigation
        function handleHashNavigation() {
          const { hash } = window.location;
          if (hash === '#supporters') {
            // Find and click the supporters tab
            const supportersTab = document.querySelector('[data-target="#supporters-panel"]') as HTMLElement;
            if (supportersTab) {
              supportersTab.click();
              
              // Scroll to the supporters section
              setTimeout(() => {
                const supportersPanel = document.getElementById('supporters-panel');
                if (supportersPanel) {
                  supportersPanel.scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                  });
                }
              }, 200);
            }
          }
        }

        // Handle hash on page load
        handleHashNavigation();

        // Handle hash changes
        window.addEventListener('hashchange', handleHashNavigation);

      });
    </script>

    <!-- Support Member Details Modal -->
    <div id="support-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
      <div class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto">
          <div class="p-6">
            <div class="flex justify-between items-start mb-6">
              <div class="flex items-start space-x-6">
                <div class="w-32 h-32 rounded-lg overflow-hidden bg-gray-200 flex-shrink-0">
                  <img id="support-modal-image" src="" alt="" class="w-full h-full object-cover">
                </div>
                <div>
                  <h2 id="support-modal-name" class="text-3xl font-bold text-primary mb-2" style="font-family: 'GT Alpina Fine', serif;"></h2>
                  <p id="support-modal-title" class="text-xl text-primary font-medium mb-1"></p>
                  <p id="support-modal-location" class="text-gray-600 mb-3"></p>
                  <div id="support-modal-social" class="flex space-x-4">
                    <!-- Social links will be inserted here -->
                  </div>
                </div>
              </div>
              <button
                onclick="closeSupportModal()"
                class="text-gray-500 hover:text-gray-700 text-2xl font-bold"
              >
                ×
              </button>
            </div>
            <div id="support-modal-content" class="text-primary space-y-6">
              <!-- Markdown content will be inserted here -->
            </div>
            <div class="mt-8 flex justify-end">
              <button
                onclick="closeSupportModal()"
                class="px-6 py-2 bg-primary text-white rounded-full font-medium hover:bg-primary transition-colors duration-200"
              >
                Close
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script define:vars={{ supportTeamMembers }}>
      // Support member details functionality

      // eslint-disable-next-line @typescript-eslint/no-unused-vars
      function showSupportMemberDetails(slug) {
        const member = supportTeamMembers.find(m => m.slug === slug);
        if (!member) return;

        // Update modal content
        const modalImage = document.getElementById('support-modal-image');
        const modalName = document.getElementById('support-modal-name');
        const modalTitle = document.getElementById('support-modal-title');
        const modalLocation = document.getElementById('support-modal-location');
        
        if (modalImage) {
          modalImage.src = member.image;
          modalImage.alt = member.name;
        }
        if (modalName) modalName.textContent = member.name;
        if (modalTitle) modalTitle.textContent = member.title;
        if (modalLocation) modalLocation.textContent = member.location;

        // Update social links
        const socialContainer = document.getElementById('support-modal-social');
        if (socialContainer) {
          socialContainer.innerHTML = '';
          
          if (member.linkedin) {
            const linkedinLink = document.createElement('a');
            linkedinLink.href = member.linkedin;
            linkedinLink.target = '_blank';
            linkedinLink.className = 'text-primary hover:text-primary transition-colors duration-200';
            linkedinLink.innerHTML = '<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>';
            socialContainer.appendChild(linkedinLink);
          }

          if (member.twitter) {
            const twitterLink = document.createElement('a');
            twitterLink.href = member.twitter;
            twitterLink.target = '_blank';
            twitterLink.className = 'text-primary hover:text-primary transition-colors duration-200';
            twitterLink.innerHTML = '<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg>';
            socialContainer.appendChild(twitterLink);
          }

          if (member.email) {
            const emailLink = document.createElement('a');
            emailLink.href = `mailto:${member.email}`;
            emailLink.className = 'text-primary hover:text-primary transition-colors duration-200';
            emailLink.innerHTML = '<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>';
            socialContainer.appendChild(emailLink);
          }
        }

        // Update bio content
        const contentContainer = document.getElementById('support-modal-content');
        if (contentContainer) {
          contentContainer.innerHTML = `<p class="text-gray-600">${member.bio}</p>`;
        }

        // Show modal
        const modal = document.getElementById('support-modal');
        if (modal) {
          modal.classList.remove('hidden');
        }
      }

      // eslint-disable-next-line @typescript-eslint/no-unused-vars
      function closeSupportModal() {
        const modal = document.getElementById('support-modal');
        if (modal) {
          modal.classList.add('hidden');
        }
      }
    </script>

    <!-- Initialize content animations -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        setTimeout(() => {
          const staggerContainer = document.querySelector('.content-stagger');
          if (staggerContainer) {
            staggerContainer.classList.add('loaded');
          }
        }, 100);

        // Language preference handling
        const storedLocale = localStorage.getItem('alife-locale');
        const currentPath = window.location.pathname;
        
        // If user has a stored preference, redirect to the appropriate localized path
        if (storedLocale) {
          if (storedLocale === 'ja' && !currentPath.startsWith('/ja/')) {
            // Redirect to Japanese version
            window.location.href = `/ja${currentPath}`;
          } else if (storedLocale === 'en' && currentPath.startsWith('/ja/')) {
            // Redirect to English version (remove /ja prefix)
            const englishPath = currentPath.replace('/ja', '');
            window.location.href = englishPath;
          }
        }
      });
    </script>

  </body>
</html>

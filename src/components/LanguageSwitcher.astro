---
import { type Locale } from '../utils/i18n.ts';

export interface Props {
  currentLocale: Locale;
  currentPath: string;
}

const { currentLocale } = Astro.props;
---

<div class="flex items-center gap-1">
  {currentLocale === 'en' ? (
    <span class="text-sm font-semibold text-primary bg-primary/10 px-2 py-1 rounded-md cursor-default">
      EN
    </span>
  ) : (
    <a 
      href="#"
      class="text-sm font-medium transition-all duration-200 text-primary/70 hover:text-primary hover:bg-primary/5 px-2 py-1 rounded-md"
      onclick="
        console.log('Switching to English...');
        const currentPathEn = window.location.pathname;
        console.log('Current path:', currentPathEn);
        
        // Clean the path - remove any locale prefix and base path
        let cleanPathEn = currentPathEn;
        if (cleanPathEn.startsWith('/alife-web')) {
          cleanPathEn = cleanPathEn.replace('/alife-web', '');
        }
        if (cleanPathEn.startsWith('/ja/')) {
          cleanPathEn = cleanPathEn.replace('/ja/', '/');
        } else if (cleanPathEn === '/ja') {
          cleanPathEn = '/';
        }
        
        const targetUrlEn = cleanPathEn === '/' ? '/alife-web' : `/alife-web${cleanPathEn}`;
        console.log('Target URL:', targetUrlEn);
        
        localStorage.setItem('alife-locale', 'en');
        console.log('Set stored locale to English');
        window.location.href = targetUrlEn;
        return false;
      "
    >
      EN
    </a>
  )}
  <span class="text-primary/30 mx-1">|</span>
  {currentLocale === 'ja' ? (
    <span class="text-sm font-semibold text-primary bg-primary/10 px-2 py-1 rounded-md cursor-default">
      JP
    </span>
  ) : (
    <a 
      href="#"
      class="text-sm font-medium transition-all duration-200 text-primary/70 hover:text-primary hover:bg-primary/5 px-2 py-1 rounded-md"
      onclick="
        console.log('Switching to Japanese...');
        const currentPathJp = window.location.pathname;
        console.log('Current path:', currentPathJp);
        
        // Clean the path - remove any locale prefix and base path
        let cleanPathJp = currentPathJp;
        if (cleanPathJp.startsWith('/alife-web')) {
          cleanPathJp = cleanPathJp.replace('/alife-web', '');
        }
        if (cleanPathJp.startsWith('/ja/')) {
          cleanPathJp = cleanPathJp.replace('/ja/', '/');
        } else if (cleanPathJp === '/ja') {
          cleanPathJp = '/';
        }
        
        const targetUrlJp = cleanPathJp === '/' ? '/alife-web/ja' : `/alife-web/ja${cleanPathJp}`;
        console.log('Target URL:', targetUrlJp);
        
        localStorage.setItem('alife-locale', 'ja');
        console.log('Set stored locale to Japanese');
        window.location.href = targetUrlJp;
        return false;
      "
    >
      JP
    </a>
  )}
</div>

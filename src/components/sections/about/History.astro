---
import '../../../styles/global.css';
import { t, type Locale } from '../../../utils/i18n.ts';

export interface Props {
  locale?: Locale;
}

const { locale = 'en' } = Astro.props;
---

<!-- History Content -->
<div class="max-w-4xl mx-auto px-4 mt-12">
  <style>
    /* Timeline Animation Styles */
    .timeline-line {
      transform: scaleY(0);
      transform-origin: top;
      transition: transform 1.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .timeline-line.animate {
      transform: scaleY(1);
    }
    
    .timeline-dot {
      opacity: 0;
      transform: scale(0);
      transition: opacity 0.6s ease-out, transform 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    
    .timeline-dot.animate {
      opacity: 1;
      transform: scale(1);
    }
    
    .timeline-content {
      opacity: 0;
      transform: translateY(30px);
      transition: opacity 0.8s ease-out, transform 0.8s ease-out;
    }
    
    .timeline-content.animate {
      opacity: 1;
      transform: translateY(0);
    }
    
    /* Staggered animation delays */
    .timeline-item:nth-child(1) .timeline-content { transition-delay: 0.2s; }
    .timeline-item:nth-child(2) .timeline-content { transition-delay: 0.4s; }
    .timeline-item:nth-child(3) .timeline-content { transition-delay: 0.6s; }
    .timeline-item:nth-child(4) .timeline-content { transition-delay: 0.8s; }
    .timeline-item:nth-child(5) .timeline-content { transition-delay: 1.0s; }
    
    .timeline-item:nth-child(1) .timeline-dot { transition-delay: 0.1s; }
    .timeline-item:nth-child(2) .timeline-dot { transition-delay: 0.3s; }
    .timeline-item:nth-child(3) .timeline-dot { transition-delay: 0.5s; }
    .timeline-item:nth-child(4) .timeline-dot { transition-delay: 0.7s; }
    .timeline-item:nth-child(5) .timeline-dot { transition-delay: 0.9s; }
    
    /* Desktop horizontal timeline dot positioning */
    @media (min-width: 768px) {
      .timeline-item .timeline-dot {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 20;
        opacity: 1 !important;
        display: block !important;
        visibility: visible !important;
      }
      
      /* Ensure first and last dots connect to line tips */
      .timeline-item:first-child .timeline-dot {
        left: 1.5rem;
        transform: translate(-50%, -50%);
      }
      
      .timeline-item:last-child .timeline-dot {
        right: 1.5rem;
        left: auto;
        transform: translate(50%, -50%);
      }
    }
    
    /* Mobile timeline specific styling */
    @media (max-width: 767px) {
      .mobile-timeline-line {
        position: absolute;
        left: 50%;
        top: 0;
        width: 1px;
        background-color: #2E3192;
        transform: translateX(-50%);
        z-index: 1;
      }
      
      .mobile-timeline-dot {
        width: 12px !important;
        height: 12px !important;
        background-color: #2E3192 !important;
        border: 2px solid white !important;
        border-radius: 50% !important;
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
        transform: scale(1) !important;
        position: relative !important;
        z-index: 10 !important;
        flex-shrink: 0 !important;
      }
      
      .timeline-content {
        opacity: 1 !important;
        transform: translateY(0) !important;
      }
      
      .timeline-line {
        transform: scaleY(1) !important;
      }
      
      /* Ensure mobile timeline dots are visible and properly positioned */
      .md\\:hidden .mobile-timeline-dot {
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
        position: relative !important;
        z-index: 10 !important;
      }
      
      /* Override any conflicting styles for mobile dots */
      .md\\:hidden .timeline-item .mobile-timeline-dot {
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
        transform: scale(1) !important;
        width: 12px !important;
        height: 12px !important;
        background-color: #2E3192 !important;
        border: 2px solid white !important;
        border-radius: 50% !important;
      }
      
      /* Force mobile dots to be visible */
      .md\\:hidden .mobile-timeline-dot {
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
        width: 12px !important;
        height: 12px !important;
        background-color: #2E3192 !important;
        border: 2px solid white !important;
        border-radius: 50% !important;
        position: relative !important;
        z-index: 10 !important;
      }
    }
  </style>
  
  <h2 class="text-64px text-primary text-center mb-2" style={`font-family: ${locale === 'ja' ? "'Noto Sans JP', sans-serif" : "'GT Alpina Fine', serif"};`}>{t(locale, 'about.history')}</h2>
  <div class="text-center mb-15">
    <span class="text-20px text-primary" style={`font-family: ${locale === 'ja' ? "'Noto Sans JP', sans-serif" : "'Inter', sans-serif"}; line-height: 2; font-weight: 300;`}>{t(locale, 'about.historyText')}</span>
  </div>

  <!-- Timeline -->
  <div class="relative max-w-6xl mx-auto">
    <!-- Desktop Timeline Line (Horizontal) -->
    <div class="timeline-line absolute top-1/2 h-px transform -translate-y-1/2 hidden md:block" style="left: 50%; transform: translateX(-50%) translateY(-50%); width: calc(100% - 3rem); background-color: #2E3192;"></div>
    <!-- Mobile Timeline Line (Vertical) -->
    <div class="mobile-timeline-line md:hidden" style="height: calc(100% - 0.75rem);"></div>
    <!-- Desktop Horizontal Layout -->
    <div class="hidden md:flex items-center justify-between py-16">
      <!-- Item 1 -->
      <div class="timeline-item flex flex-col items-center text-center relative w-1/3">
        <div class="timeline-content mb-12">
          <span class="text-40px text-primary block" style="font-family: 'GT Alpina Fine', serif;">Sakana.ai</span>
          <span class="inline-flex items-center gap-x-1.5 py-1 px-3 rounded-full text-xs bg-primary text-white mt-2">Jan, 2024</span>
          <p class="text-20px text-primary mt-2 max-w-100">1st Japanese company with a focus on ALife. $30M seed round.</p>
        </div>
        <div class="timeline-dot size-3 rounded-full bg-primary border-2 border-white"></div>
        <div class="timeline-content mt-12">
          <img src="/assets/images/We-raised-30M 1.svg" alt="Sakana.ai Logo" class="h-55 w-47 mx-auto" loading="lazy"/>
        </div>
      </div>

      <!-- Item 2 -->
      <div class="timeline-item flex flex-col items-center text-center relative w-1/3">
        <div class="timeline-content mb-12">
          <img src="/assets/logo/logo3.svg" alt="ALIFE Logo" class="h-30 w-42  filter-primary" loading="lazy"/>
        </div>
        <div class="timeline-dot size-3 rounded-full bg-primary border-2 border-white"></div>
        <div class="timeline-content mt-10">
          <span class="text-40px text-primary block" style="font-family: 'GT Alpina Fine', serif;">ALIFE Institute Incorporated</span>
        </div>
      </div>

      <div class="timeline-item flex flex-col items-center text-center relative w-1/3">
        <div class="timeline-content mb-12">
          <span class="text-40px text-primary block" style="font-family: 'GT Alpina Fine', serif;">Research Projects Began</span>
          <span class="inline-flex items-center gap-x-1.5 py-1 px-3 rounded-full text-xs bg-primary text-white mt-2">Dec, 2024</span>
        </div>
        <div class="timeline-dot size-3 rounded-full bg-primary border-2 border-white"></div>
        <div class="timeline-content mt-12">
          <div class="grid grid-cols-3 gap-2">
              <img src="/assets/research-project/Ellipse 314.svg" alt="Primordial Soup" class="w-full h-12 object-cover" loading="lazy" style="border-radius: 10px;"/>
              <img src="/assets/research-project/Ellipse 315.svg" alt="Structure" class="w-full h-12 object-cover"/>
              <img src="/assets/research-project/Ellipse 316.svg" alt="Locomotion" class="w-full h-12 object-cover"/>
              <img src="/assets/research-project/Ellipse 317.svg" alt="Coevolution" class="w-full h-12 object-cover"/>
              <img src="/assets/research-project/Ellipse 318.svg" alt="Coevolution" class="w-full h-12 object-cover"/>
              <img src="/assets/research-project/Ellipse 319.svg" alt="Coevolution" class="w-full h-12 object-cover"/>
          </div>
        </div>
      </div>
    </div>

    <!-- Mobile Vertical Layout -->
    <div class="md:hidden">
      <!-- Item -->
      <div class="timeline-item flex items-start mb-8">
        <!-- Left Content -->
        <div class="timeline-content w-1/2 pr-8 text-end">
          <span class="text-3xl text-primary" style="font-family: 'GT Alpina Fine', serif;">Sakana.ai</span>
          <br/>
          <span class="inline-flex items-center gap-x-1.5 py-1 px-5 rounded-full text-xs bg-primary text-white">Jan, 2024</span>
          <br/>
          <span class="text-xs text-primary mt-2 block">1st Japanese company with a focus on ALife.<br/>$30M seed round Jan, 2024.</span>
        </div>
        <!-- End Left Content -->

          <!-- Icon -->
          <div class="relative z-10 size-7 flex justify-center items-start">
        <div class="timeline-dot size-3 rounded-full bg-primary border-2 border-white"></div>
          </div>
        <!-- End Icon -->

        <!-- Right Content -->
        <div class="timeline-content w-1/2 pl-8">
          <img src="/assets/images/We-raised-30M 1.svg" alt="Sakana.ai Logo" class="h-25 w-50 mt-5" loading="lazy"/>
        </div>
        <!-- End Right Content -->
      </div>
      <!-- End Item -->

      <!-- Item -->
      <div class="timeline-item flex items-center mb-8">
        <!-- Left Content -->
        <div class="timeline-content w-1/2 pr-8 flex justify-end">
          <img src="/assets/logo/logo3.svg" alt="ALIFE Logo" class="h-15 w-30 mt-5 filter-primary" loading="lazy"/>
        </div>
        <!-- End Left Content -->

        <!-- Icon -->
        <div class="relative z-10 size-7 flex justify-center items-center">
        <div class="timeline-dot size-3 rounded-full bg-primary border-2 border-white"></div>
        </div>
        <!-- End Icon -->

        <!-- Right Content -->
        <div class="timeline-content w-1/2 pl-8">
          <span class="text-2xl text-primary" style="font-family: 'GT Alpina Fine', serif;">Alife</span>
          <br/>
          <span class="text-2xl text-primary" style="font-family: 'GT Alpina Fine', serif;">Institute Incorporated</span>
        </div>
        <!-- End Right Content -->
      </div>
      <!-- End Item -->

      <!-- Item -->
      <div class="timeline-item flex items-center mb-8">
        <!-- Left Content -->
        <div class="timeline-content w-1/2 pr-8 text-end">
          <span class="text-2xl text-primary" style="font-family: 'GT Alpina Fine', serif;">Research</span>
          <br/>
          <span class="text-2xl text-primary" style="font-family: 'GT Alpina Fine', serif;">Projects Began</span>
          <br/>
          <span class="inline-flex items-center gap-x-1.5 py-1 px-5 rounded-full text-xs bg-primary text-white">Dec, 2024</span>
        </div>
        <!-- End Left Content -->

        <!-- Icon -->
        <div class="relative z-10 size-7 flex justify-center items-center">
        <div class="timeline-dot size-3 rounded-full bg-primary border-2 border-white"></div>
        </div>
        <!-- End Icon -->

        <!-- Right Content -->
        <div class="timeline-content w-1/2 pl-8">
          <!-- ALife Research Grid -->
          <div class="grid grid-cols-2 gap-2 max-w-md">
            <div class="text-center">
              <div class="overflow-hidden">
                <img src="/assets/research-project/Ellipse 314.svg" alt="Primordial Soup" class="w-full h-21 object-cover" loading="lazy"/>
              </div>
            </div>
            <div class="text-center">
              <div class="overflow-hidden">
                <img src="/assets/research-project/Ellipse 315.svg" alt="Structure" class="w-full h-21 object-cover" loading="lazy"/>
              </div>
            </div>
            <div class="text-center">
              <div class="overflow-hidden">
                <img src="/assets/research-project/Ellipse 316.svg" alt="Locomotion" class="w-full h-21 object-cover" loading="lazy"/>
              </div>
            </div>
            <div class="text-center">
              <div class="overflow-hidden">
                <img src="/assets/research-project/Ellipse 317.svg" alt="Coevolution" class="w-full h-21 object-cover" loading="lazy"/>
              </div>
            </div>
            <div class="text-center">
              <div class="overflow-hidden">
                <img src="/assets/research-project/Ellipse 318.svg" alt="Complexification" class="w-full h-21 object-cover" loading="lazy"/>
              </div>
            </div>
            <div class="text-center">
              <div class="overflow-hidden">
                <img src="/assets/research-project/Ellipse 319.svg" alt="Disordered Structures" class="w-full h-21 object-cover" loading="lazy"/>
              </div>
            </div>
          </div>
        </div>
        <!-- End Right Content -->
      </div>
      <!-- End Item -->
    </div>
    <!-- End Mobile Layout -->
  </div>

  <div class="flex justify-center mt-10">
    <p class="text-20px" style={`color: #FFAC3F; font-family: ${locale === 'ja' ? "'Noto Sans JP', sans-serif" : "'Inter', sans-serif"};`}>{t(locale, 'about.historyNote')}</p><br />
  </div>  
  <div class="flex justify-center">
    <p class="text-20px text-primary" style={`font-family: ${locale === 'ja' ? "'Noto Sans JP', sans-serif" : "'Inter', sans-serif"};`}>{t(locale, 'about.historyCallToAction')}</p>
  </div> 
  <!-- End Timeline -->
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const timelineLine = document.querySelector('.timeline-line');
    const timelineDots = document.querySelectorAll('.timeline-dot');
    const timelineContents = document.querySelectorAll('.timeline-content');
    
    // Function to check if element is in viewport
    function isInViewport(element: Element) {
      const rect = element.getBoundingClientRect();
      const windowHeight = window.innerHeight || document.documentElement.clientHeight;
      return rect.top < windowHeight && rect.bottom > 0;
    }
    
    // Function to trigger animations
    function triggerAnimations() {
      if (timelineLine && isInViewport(timelineLine) && !timelineLine.classList.contains('animate')) {
        // Animate timeline line
        timelineLine.classList.add('animate');
        
        // Animate dots with staggered delay
        setTimeout(() => {
          timelineDots.forEach((dot, index) => {
            setTimeout(() => {
              dot.classList.add('animate');
            }, index * 200);
          });
        }, 300);
        
        // Animate content with staggered delay
        setTimeout(() => {
          timelineContents.forEach((content, index) => {
            setTimeout(() => {
              content.classList.add('animate');
            }, index * 150);
          });
        }, 500);
      }
    }
    
    // Trigger animations on scroll
    window.addEventListener('scroll', triggerAnimations);
    
    // Trigger animations immediately if already in viewport
    setTimeout(triggerAnimations, 100);
  });
</script>
